<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz | Chapéu seletor</title>
    <link rel="stylesheet" href="./css/style-quiz.css">
</head>

<body>
    <div class="box-maior">
        <div class="inner-box">
            <div class="div_esquerda">
                <!-- quiz -->
                <div id="quiz">

                    <div id="div_inicio">
                        <!-- <div class="saida">
                            <img src="./assets/quiz/arrow-left-solid.svg" alt="" width="30px;">
                        </div> -->
                        <button id="btn-quiz" onclick="iniciar()">Iniciar quiz</button>
                    </div>

                    <div id="div_questao1" style="display: none;">

                        <p>Qual qualidade você mais valoriza?</p> <br>
                        <button id="btn-questao" onclick="selecionarResposta1('grifinoria')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Coragem
                        </button> <br>

                        <button id="btn-questao" onclick="selecionarResposta1('corvinal')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Inteligência
                        </button> <br>

                        <button id="btn-questao" onclick="selecionarResposta1('lufalufa')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Lealdade
                        </button> <br>

                        <button id="btn-questao" onclick="selecionarResposta1('sonserina')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Sabedoria
                        </button> <br><br>

                    </div>

                    <div id="div_questao2" style="display: none;">

                        <p>Dentre esses, qual você mais valoriza em um amigo?</p> <br>
                        <button id="btn-questao" onclick="selecionarResposta2('grifinoria')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Coragem e Ousadia
                        </button><br>

                        <button id="btn-questao" onclick="selecionarResposta2('corvinal')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Inteligência e Criatividade
                        </button> <br>

                        <button id="btn-questao" onclick="selecionarResposta2('lufalufa')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Lealdade e Amizade
                        </button><br>

                        <button id="btn-questao" onclick="selecionarResposta2('sonserina')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Sabedoria e Curiosidade
                        </button> <br><br>

                    </div>

                    <div id="div_questao3" style="display: none;">

                        <p>Como você gosta de passar seu tempo livre?</p> <br>
                        <button id="btn-questao" onclick="selecionarResposta3('grifinoria')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Aventurando-se e enfrentando desafios
                        </button> <br>

                        <button id="btn-questao" onclick="selecionarResposta3('corvinal')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Lendo e aprendendo coisas novas</button> <br>

                        <button id="btn-questao" onclick="selecionarResposta3('lufalufa')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Passando tempo com amigos e familiares
                        </button> <br>

                        <button id="btn-questao" onclick="selecionarResposta3('sonserina')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Resolvendo quebra-cabeças e enigmas
                        </button> <br><br>

                    </div>

                    <div id="div_questao4" style="display: none;">

                        <p>Em uma situação difícil, o que você prefere?</p> <br>
                        <button id="btn-questao" onclick="selecionarResposta4('grifinoria')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Agir rapidamente, mesmo que seja arriscado
                        </button> <br>

                        <button id="btn-questao" onclick="selecionarResposta4('corvinal')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Pensar cuidadosamente e planejar a melhor abordagem
                        </button> <br>

                        <button id="btn-questao" onclick="selecionarResposta4('lufalufa')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Contar com o apoio de amigos e entes queridos
                        </button> <br>

                        <button id="btn-questao" onclick="selecionarResposta4('sonserina')">
                            <img src="./assets/quiz/circle-regular.svg" style="width: 10px;">
                            Usar seu conhecimento e sabedoria para resolver o problema
                        </button> <br><br>

                    </div>

                    <div id="div_final" style="display: none;">

                        <button type="button" id="btn-quiz" onclick="selecionarCasa()">Ver Resultado</button> <br><br>
                        <!-- <button id="btn-quiz" onclick="reiniciar()">Reiniciar</button> -->

                    </div>

                </div>

            </div>

            <!-- <div class="div_direita"> -->
            <div class="div_result_casa">
                <p>Sua casa é:</p> <br>
                <div id="div_resultado"></div>
            </div>

            <!-- </div> -->

        </div>
    </div>

</body>

</html>
<!-- <script src="./src/controllers/quizController.js"></script> -->
<script>
    var respostas = [];

    function iniciar() {
        div_inicio.innerHTML = "";
        div_questao1.style.display = 'block';
    }

    function selecionarResposta1(resposta) {
        respostas.push(resposta);
        console.log(respostas);

        div_questao1.innerHTML = "";
        div_questao2.style.display = 'block';
    }

    function selecionarResposta2(resposta) {
        respostas.push(resposta);
        console.log(respostas);

        div_questao2.innerHTML = "";
        div_questao3.style.display = 'block';
    }

    function selecionarResposta3(resposta) {
        respostas.push(resposta);
        console.log(respostas);

        div_questao3.innerHTML = "";
        div_questao4.style.display = 'block';
    }

    function selecionarResposta4(resposta) {
        respostas.push(resposta);
        console.log(respostas);

        div_questao4.innerHTML = "";
        div_final.style.display = 'block';
    }

    // function reiniciar() {
    //     div_final.innerHTML = "";
    //     div_inicio.innerHTML = `
    //         <div id="div_inicio">
    //             <button id="btn-quiz" onclick="iniciar()">Iniciar quiz</button>
    //         </div>
    //     ` ;
    // }

    function selecionarCasa() {
        var casa = "";

        pontosGrifinoria = 0;
        pontosCorvinal = 0;
        pontosLufaLufa = 0;
        pontosSonserina = 0;

        for (var i = 0; i < respostas.length; i++) {
            if (respostas[i] == 'grifinoria') {
                pontosGrifinoria += 5;
            }
            else if (respostas[i] == 'corvinal') {
                pontosCorvinal += 5;
            }
            else if (respostas[i] == 'lufalufa') {
                pontosLufaLufa += 5;
            }
            else if (respostas[i] == 'sonserina') {
                pontosSonserina += 5;
            }
        }

        var maxPontos = respostas.length * 5;
        var percentualGrifinoria = (pontosGrifinoria / maxPontos) * 100;
        var percentualCorvinal = (pontosCorvinal / maxPontos) * 100;
        var percentualLufaLufa = (pontosLufaLufa / maxPontos) * 100;
        var percentualSonserina = (pontosSonserina / maxPontos) * 100;

        if (percentualGrifinoria > percentualCorvinal && percentualGrifinoria > percentualLufaLufa && percentualGrifinoria > percentualSonserina) {
        var casa = 'Grifinória';
        var fkCasaVar = casa;
        // var idCasaVar = 100;  // Ajuste conforme o ID real da Grifinória.

        // Chama a função para obter o ID da casa
        // quizController.obterIdCasa(casa)
        //     .then(function (idCasaObtido) {
                // if (idCasaObtido === idCasa) {
                    // Se o ID da casa obtido é o esperado, faz a requisição para cadastrar a fkCasa
                    fetch("/quiz/cadastrarCasa", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            fkCasaServer: fkCasaVar,
                            idCasa: sessionStorage.idCasa
                            // idCasaServer: idCasaVar
                        })
                    }).then(function (resposta) {
                        console.log("ESTOU NO THEN DO entrar()!");

                        if (resposta.ok) {
                            console.log(resposta);

                            resposta.json().then(json => {
                                console.log(json);
                                console.log(JSON.stringify(json));
                            });
                        } else {
                            console.log("Houve um erro ao tentar realizar o login!");
                            alert("Erro");

                            resposta.text().then(texto => {
                                console.error(texto);
                            });
                        }
                    }).catch(function (erro) {
                        console.log(erro);
                    });
                // } else {
                //     console.error("ID da casa obtido não corresponde ao esperado.");
                // }
            // })
            // .catch(function (erro) {
            //     console.error(erro);
            // });
    }


        // if (percentualGrifinoria > percentualCorvinal && percentualGrifinoria > percentualLufaLufa && percentualGrifinoria > percentualSonserina) {
        //     casa = `Grifinória`;
        //     var idCasa = 100;
            
        //     //cria uma requisição
        //     // fetch 

        //     //vai ter a tabela casa contendo os nomes das casas -> if(casa = 'Grifinória' == idCasa = 100)
        //     // oq preciso cadastrar é a fkCasa na tabela usuario

        //     obterIdCasa(casa)

        //         fetch("/quiz/cadastrarCasa", {
        //             method: "POST",
        //             headers: {
        //                 "Content-Type": "application/json"
        //             },
        //             body: JSON.stringify({
        //                 fkCasaServer: fkCasaVar,
        //                 idCasaServer: idCasaVar

        //             })
        //         }).then(function (resposta) {
        //             console.log("ESTOU NO THEN DO entrar()!")

        //             if (resposta.ok) {
        //                 console.log(resposta);
                        
        //                 resposta.json().then(json => {
        //                     console.log(json);
        //                     console.log(JSON.stringify(json));

        //                 });

        //             } else {

        //                 console.log("Houve um erro ao tentar realizar o login!");
        //                 alert(`Erro`);

        //                 resposta.text().then(texto => {
        //                     console.error(texto);

        //                 });
        //             }

        //         }).catch(function (erro) {
        //             console.log(erro);
        //         })


        // }
        else if (percentualCorvinal > percentualLufaLufa && percentualCorvinal > percentualSonserina) {
            casa = `Corvinal`;
        }
        else if (percentualLufaLufa > percentualSonserina) {
            casa = `Lufa-Lufa`;
        }
        else {
            casa = `Sonserina`;
        }

        div_resultado.innerHTML = `${casa}`
    }
</script>